<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Halo的主页 - Kubernetes Operator 开发</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&display=swap" rel=stylesheet><link rel=stylesheet href=../../css/halo.css><link rel=stylesheet href=../../css/github-markdown.css><link rel=stylesheet href=../../css/github-markdown-light.css><link rel=stylesheet href=../../css/markdown-rewrite.css><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><style>body{display:flex;flex-direction:column;align-items:center}a{color:#5e5e5e;text-decoration:none}</style></head><body><div id=mob-warning>当前内容暂不适配移动端。<br>请使用桌面端查看。</div><div id=top style=width:0;height:0></div><div class=top-button><a href=#top style=text-decoration:none>Top</a></div><div id=toc>目<br>录</div><div id=header><div style=width:100%;display:flex;align-items:center;height:100%><div class=disable-select style=display:flex;justify-content:flex-end;font-size:14pt;font-weight:700;color:#555><div style=margin-right:35px></div><div><a style=color:#555;text-decoration:none href=../../>&lt;Halo的主页/></a></div></div><div style=flex:1;display:flex;justify-content:flex-end;font-size:14pt;font-weight:700;color:#555><div style=margin-right:45px><a href=https://www.wecomz.com style=color:#555;text-decoration:none>WecomZ</a></div><div style=margin-right:45px><a href=../../article style=color:#555;text-decoration:none>文章</a></div><div style=margin-right:45px><a href=../../video style=color:#555;text-decoration:none>视频</a></div><div style=margin-right:45px><a href=../../about style=color:#555;text-decoration:none>关于</a></div><div style=margin-left:35px></div></div></div></div><div id=article-content><div class=content-header><div>《Kubernetes Operator 开发》</div><div style=font-size:10pt;height:100%;display:flex;align-items:flex-end;padding-bottom:12pt;color:#5e5e5e;font-weight:lighter>在2023/06/23 00:30:13更新，大约共500字。</div></div><div class=content-desc><div style=font-size:50pt;font-weight:700;color:#eee;padding-right:15px>“</div><div style=line-height:50pt;color:#9b9b9b>[迁移]开发 Operator 的指南</div><div style=font-size:50pt;font-weight:700;color:#eee;padding-left:15px>”</div></div><div class="content-area markdown-body"><p>Kubernetes 通过命令行（kubectl）或者 YAML 的方式将请求数据转换为 JSON，然后发送到 API Server，不同的资源会有不同的 Controller 来负责，Controller 维护了这些资源的期望状态。
例如 Pod、Service 等，这都是 Kubernetes 中预定义的对象，对于自定义的对象，我们就需要通过 Operator 来实现了。</p><p>Operator 概念由 CoreOS 的 CTO Brandon Philips 在2016年提出，SRE通过编写运维软件来运维应用，他们是工程师，也是开发者，知道怎么针对特定应用领域来开发运维软件，这些运维软件中包含特定应用领域的运维经验。
我们把这种新的软件类型叫作 Operator。</p><h1 id=前言>前言</h1><p>一个 Operator 是特定应用的控制器，通过拓展 Kubernetes API 来创建、配置和管理复杂有状态的应用实例，代替用户人工操作。它构建在 Kubernetes Resource 和 Controller 概念之上，同时包含领域或应用特定的知识，从而自动化地实现通用的运维任务。
Operator 模式是 Kubernetes 高度可拓展性的精髓所在，官方文档对 Operator 模式的介绍可以在中找到：<a href=https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/operator/>https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/operator/</a>。Operator 的初衷在于人们都喜欢通过自动化来处理重复的任务，通过 Operator 来封装这些繁琐的流程。</p><p>Operator 可以做的事情如下：</p><ul><li>按需部署应用。</li><li>获取/还原应用状态的备份。</li><li>处理应用代码的升级以及相关改动。例如数据库 Schema 或额外的配置设置。</li><li>发布一个 Service，要求不支持 Kubernetes API 的应用也能发现它。</li><li>模拟整个或部分集群中的故障以测试其稳定性。</li><li>在没有内部成员选举程序的情况下，为分布式应用选择首领角色。</li></ul><p>一个典型的 Operator 如下：</p><ul><li>定义一个 Kubernetes 自定义资源，例如叫做 SampleDB。</li><li>一个包含 Operator Controller 部分的 Deployment（用于无状态的 CRD） 或者 StatefulSet（用于有状态的 CRD），用来确保 Pod 处于 Running 状态。</li><li>包含 Operator 代码的容器镜像。</li><li>Controller 代码，负责查询控制平面找出已经配置的 SampleDB 资源。</li><li>Operator 的核心是告诉 API Server，如何使现有 Kubernetes 集群状态与代码里配置的资源匹配，例如：<ul><li>如果添加新的 SampleDB，Operator 将设置 PersistentVolumeClaims 以提供持久化的数据库存储， 设置 StatefulSet 以运行 SampleDB，并设置 Job 来处理初始配置。</li><li>如果你删除它，Operator 将建立快照，然后确保 StatefulSet 和 Volume 已被删除。</li></ul></li><li>Operator 也可以管理常规数据库的备份。对于每个 SampleDB 资源，Operator 会确定何时创建（可以连接到数据库并进行备份的）Pod。这些 Pod 将依赖于 ConfigMap 和/或具有数据库连接详细信息和凭据的 Secret。</li><li>由于 Operator 旨在为其管理的资源提供强大的自动化功能，因此它还需要一些额外的支持性代码。 在这个示例中，代码将检查数据库是否正运行在旧版本上， 如果是，则创建 Job 对象为你升级数据库。</li></ul><p>部署 Operator 之后，可以通过 kubectl 命令来操作 SampleDB 这个对象，例如：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>watch kubectl get SampleDB -o wide
</span></span></code></pre></td></tr></table></div></div><p>那么，Operator 会负责应用所作的更改并保持现有服务处于良好的状态。</p><h1 id=开发>开发</h1><p>如果生态系统中没可以实现你目标的 Operator，你可以自己编写代码。你还可以使用任何支持 Kubernetes API 客户端的语言或运行时来实现 Operator（即 Controller）。</p><ul><li>如果你使用 Java，那么可以使用 <a href=https://github.com/operator-framework/java-operator-sdk>https://github.com/operator-framework/java-operator-sdk</a> 实现。</li><li>如果你使用 Python，那么可以使用 <a href=https://github.com/nolar/kopf>https://github.com/nolar/kopf</a> 实现。</li></ul><p>通常情况下，我们推荐使用 Go 语言实现 Operator，毕竟 Kubernetes 也是使用 Go 语言开发的，那么我们就会用到 <a href=https://book.kubebuilder.io/>https://book.kubebuilder.io/</a>。</p><h3 id=安装依赖>安装依赖</h3><p>目前 kubebuilder 仅支持 Linux 和 macOS，Windows 用户可以使用 WSL 来实现。下面我们来安装 kubebuilder:</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apt update <span style=color:#ff6ac1>&amp;&amp;</span> apt upgrade -y <span style=color:#ff6ac1>&amp;&amp;</span> apt install wget curl golang git make -y
</span></span><span style=display:flex><span>curl -L -o kubebuilder <span style=color:#5af78e>&#34;https://go.kubebuilder.io/dl/latest/</span><span style=color:#ff6ac1>$(</span>go env GOOS<span style=color:#ff6ac1>)</span><span style=color:#5af78e>/</span><span style=color:#ff6ac1>$(</span>go env GOARCH<span style=color:#ff6ac1>)</span><span style=color:#5af78e>&#34;</span>
</span></span><span style=display:flex><span>chmod +x kubebuilder <span style=color:#ff6ac1>&amp;&amp;</span> mv kubebuilder /usr/local/bin/
</span></span></code></pre></td></tr></table></div></div><p>接下来我们看一下版本信息：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubebuilder version
</span></span></code></pre></td></tr></table></div></div><p>看到输出了版本信息，说明安装成功了：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Version: main.version<span style=color:#ff6ac1>{</span>KubeBuilderVersion:<span style=color:#5af78e>&#34;3.11.1&#34;</span>, KubernetesVendor:<span style=color:#5af78e>&#34;1.27.1&#34;</span>, GitCommit:<span style=color:#5af78e>&#34;1dc8ed95f7cc55fef3151f749d3d541bec3423c9&#34;</span>, BuildDate:<span style=color:#5af78e>&#34;2023-07-03T13:10:56Z&#34;</span>, GoOs:<span style=color:#5af78e>&#34;linux&#34;</span>, GoArch:<span style=color:#5af78e>&#34;amd64&#34;</span><span style=color:#ff6ac1>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=创建项目>创建项目</h3><p>Kubebuilder 依赖于 Go 语言环境、Docker 和 Kubectl（确保可以访问到测试环境的 Kubernetes 集群）。</p><p>我们创建一个简单的 Operator，快速了解 Operator 的初始化、API 定义、打包和发布。我们要通过一个 Application 类型来定义一个自己的资源对象，然后在控制器中获取这个资源对象的详细配置，接着根据它的配置去创建相应数量的 Pod ，就像 Deployment 那样工作。</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir helloworld-operator <span style=color:#ff6ac1>&amp;&amp;</span> <span style=color:#ff5c57>cd</span> helloworld-operator
</span></span><span style=display:flex><span>kubebuilder init --domain<span style=color:#ff6ac1>=</span>example.com --repo<span style=color:#ff6ac1>=</span>github.com/bluemiaomiao/helloworld-operator --owner <span style=color:#5af78e>&#34;Halo Hsu&#34;</span> --skip-go-version-check
</span></span></code></pre></td></tr></table></div></div><p>项目初始化完成以后会有很多目录和文件，其主要功能如下：</p><ul><li><code>PROJECT</code>：项目的元数据。</li><li><code>main.go</code>：主进程文件。</li><li><code>config</code>：分门别类的存放了许多 YAML 配置文件。</li><li><code>Dockerfile</code>：编译和构建二进制的全部逻辑都在这里。</li><li><code>Makefile</code>：通过 make 命令构建 Operator 应用。</li></ul><p>接下来我们创建一个自定义资源：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubebuilder create api --group myapp --version v1 --kind HelloWorld
</span></span></code></pre></td></tr></table></div></div><p>kubebuilder 帮助我们创建了 <code>config</code> 目录中的相关配置，<code>controllers</code> 目录中的一些文件，以及 <code>api</code> 目录。</p><ul><li><code>api</code> 目录包含了刚才添加的 API，需要注意 <code>helloworld_types.go</code> 文件。</li><li><code>config/crd</code> 存放的是用于部署 CRD 的 kustomize 文件。</li><li><code>config/rabc</code> 存放了用于查询和编辑权限的 ClusterRole 配置文件。</li><li><code>samples/myapp_v1_helloworld.yaml</code> 是一个 CR 的示例文件，通过这个文件就可以创建一个我们自定义的 HelloWorld 类型资源。</li><li><code>controllers</code> 包含了控制器代码的逻辑入口，需要重点关注 <code>Reconcile</code> 方法。</li></ul><h3 id=实现-crd>实现 CRD</h3><p>编辑 <code>api/v1/helloworld_types.go</code> 文件，添加一些属性：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff5c57>type</span> HelloworldSpec <span style=color:#ff5c57>struct</span> {
</span></span><span style=display:flex><span>    Replicas <span style=color:#9aedfe>int32</span>                  <span style=color:#5af78e>`json:&#34;replicas,omitempty&#34;`</span>  <span style=color:#78787e>// Pod 的数量
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>    Template corev1.PodTemplateSpec <span style=color:#5af78e>`json:&#34;template,omitempty&#34;`</span>  <span style=color:#78787e>// Pod 的模板定义
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=构建与部署>构建与部署</h3><p>修改好之后，就可以构建清单文件了：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make manifests
</span></span></code></pre></td></tr></table></div></div><p>构建完成后会在 <code>config/crd/bases</code> 目录中新增 <code>myapp.example.com_helloworld.yaml</code> 文件，其中 Kind 是 <code>CustomResourceDefintion</code> 类型。
<code>spec.group</code> 是 <code>myapp.example.com</code>，<code>spec.kind</code> 是 <code>Hellworld</code> 类型。</p><p>接下来通过执行 <code>make install</code> 将 CRD 部署到 Kubernetes 集群中，然后就可以通过 kubectl 可以看到我们实现的 CRD：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get crd
</span></span><span style=display:flex><span>kubectl get helloworld
</span></span></code></pre></td></tr></table></div></div><p>此时 API Server 已经识别这种资源了。我们可以通过编写 YAML 来创建 CRD，但是并不会有任何 Pod 被创建出来，因为还没有实现 <code>Reconcile()</code> 方法。</p><p>通过 <code>make run</code> 实现测试运行，此时会打印大量的日志到标准输出。</p><h3 id=在集群上运行>在集群上运行</h3><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make docker-build docker-push <span style=color:#ff5c57>IMG</span><span style=color:#ff6ac1>=</span>&lt;some-registry&gt;/&lt;project-name&gt;:tag
</span></span></code></pre></td></tr></table></div></div><p>将控制器部署到具有指定镜像的集群:</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make deploy <span style=color:#ff5c57>IMG</span><span style=color:#ff6ac1>=</span>&lt;some-registry&gt;/&lt;project-name&gt;:tag
</span></span></code></pre></td></tr></table></div></div><p>如果你要取消 CRD 并卸载：</p><div class=highlight><div style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make undeploy
</span></span><span style=display:flex><span>make uninstall
</span></span></code></pre></td></tr></table></div></div><p>到这里，我们知道了开发一个 Operator 的具体步骤，接下来的章节将会与 Operator 有关。</p></div></div><footer id=footer><div class=footer-inner><div><div style=font-weight:700;margin-bottom:15px>发布地址</div><div><a href=https://halo.wecomz.com>Halo的主页</a></div><div><a href=https://bluemiaomiao.gitee.io>中国境内镜像</a></div><div><a href=https://bluemiaomiao.github.io>中国境外镜像</a></div></div><div><div style=font-weight:700;margin-bottom:15px>友情链接</div><div><a href=https://debuginn.cn>DebugInn</a></div><div><a href=https://blog.csdn.net/qq_43442524>普通Gopher</a></div></div><div><div style=font-weight:700;margin-bottom:15px>开源软件</div><div><a href=https://bluemiaomiao.github.io/libsshd/>OpenSSH Configuration Library</a></div><div><a href=https://bluemiaomiao.github.io/fastdfs-spring-boot-starter/>FastDFS SpringBoot Starter</a></div><div><a href=https://bluemiaomiao.github.io/librocm-smi-gobinding/>AMD ROCm SMI for Golang</a></div><div><a href=https://bluemiaomiao.github.io/libnvml-smi-gobinding>NVIDIA NVML SMI for Golang</a></div><div><a href=https://www.wecomz.com/software/zgraphics>zGraphics(Prometheus GPU Exporter)</a></div><div><a href=https://www.wecomz.com/software/ztrader>zTrader Framework</a></div></div><div><div style=font-weight:700;margin-bottom:15px>其他</div><div><a href=https://values.wecomz.com>WecomZ 价值观</a></div></div></div><div class=icp><div style=min-height:13px;min-width:13px;background-image:url(/image/beian.png);background-repeat:no-repeat;background-size:contain;margin-right:5px></div><div><a href=https://beian.miit.gov.cn target=_blank>鲁ICP备2023019133号</a></div></div></footer></body><script src=../../js/halo.js type=text/javascript></script></html>