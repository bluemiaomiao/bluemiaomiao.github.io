<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Halo的主页 - 一个高性能分布式 CMDB 平台的设计</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet href=../../css/halo.css><link rel=stylesheet href=../../css/github-markdown.css><link rel=stylesheet href=../../css/github-markdown-light.css><link rel=stylesheet href=../../css/markdown-rewrite.css><link rel="shortcut icon" href=favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><style>body{display:flex;flex-direction:column;align-items:center}a{color:#5e5e5e;text-decoration:none}</style></head><body><div id=top style=width:0;height:0></div><div class=top-button><a href=#top style=text-decoration:none>Top</a></div><div id=toc>目<br>录</div><div id=header><div style=width:100%;display:flex;align-items:center;height:100%><div class=disable-select style=display:flex;justify-content:flex-end;font-size:14pt;font-weight:700;color:#555><div style=margin-right:35px></div><div><a style=color:#555;text-decoration:none href=../../>&lt;Halo的主页/></a></div></div><div style=flex:1;display:flex;justify-content:flex-end;font-size:14pt;font-weight:700;color:#555><div style=margin-right:45px><a href=https://www.wecomz.com style=color:#555;text-decoration:none>WecomZ</a></div><div style=margin-right:45px><a href=../../article style=color:#555;text-decoration:none>文章</a></div><div style=margin-right:45px><a href=../../video style=color:#555;text-decoration:none>视频</a></div><div style=margin-right:45px><a href=../../about style=color:#555;text-decoration:none>关于</a></div><div style=margin-left:35px></div></div></div></div><div id=article-content><div class=content-header><div>《一个高性能分布式 CMDB 平台的设计》</div><div style=font-size:10pt;height:100%;display:flex;align-items:flex-end;padding-bottom:12pt;color:#5e5e5e;font-weight:lighter>在2023/01/07 00:25:20更新，大约共100字。</div></div><div class=content-desc><div style=font-size:50pt;font-weight:700;color:#eee;padding-right:15px>“</div><div style=line-height:50pt;color:#9b9b9b>[迁移]面向云原生的 CMDB 平台的设计思路。</div><div style=font-size:50pt;font-weight:700;color:#eee;padding-left:15px>”</div></div><div class="content-area markdown-body"><p>任何一个 CMDB 都不值得开源，因为每个公司都不一样。</p><p>因为成本问题，公司管理层决定替换掉 <a href=https://www.manageengine.com/>ManageEngine</a> 的 ServiceDesk Plus 服务。这是第一次自己设计的运维平台系统允许被通过外部文章的方式发布出来。这篇文章介绍了针对 Web 业务类型的公司如何从零构建一个 CMDB 系统。笔者所在的公司有相当一部分裸金属服务，还有一个阿里云的 ECS 云虚拟机，我们在云虚拟机上部署了 Kubernetes 集群。</p><p>由于笔者的公司主要深耕在线教育行业，视频和文章是必须的。我们通过 ffmpeg、h264、h265 程序对原始数据进行压制。通过对象存储实现我们的视频、音频和图片内容的存储。一些评论通过 MongoDB 存储。我们有很多学员在海外，全球网络延时也是很大的阻碍因素。接下来我们将讨论如何避免这样的问题。</p><h1 id=架构图>架构图</h1><p>笔者所在公司的研发部门使用 Java 构建业务应用，我们运维部门决定采用 Go 语言和 Vue.js 构建我们的运维系统。话不多说，先上架构图：</p><p><img src=../../article/a-fast-distributed-cmdb-design/arch.svg alt></p><p>先放一句大话：此架构适用于任何规模的公司！</p><h1 id=现有集群的复用>现有集群的复用</h1><ul><li><strong>分布式配置数据存储</strong>：由于笔者所在的公司全部使用 MongoDB，那么我们运维部门也考虑采用 MongoDB，毕竟有先前的经验积累，另外可以复用现有的 MongoDB 集群。</li><li><strong>分布式协调</strong>：此外我们还复用了现有的分布式协调集群 ———— Zookeeper，不过这个运维平台从代码上兼容了 ZooKeeper 和 ETCD，通过配置文件的驱动字段可以修改。</li><li><strong>分布式消息系统</strong>：业务部门使用了 Kafka 作为消息中间件，另外我们还使用了 ELK 作为在线日志系统供研发部门查询，所以消息集群仍旧是 Kafka。</li></ul><h1 id=运维业务元数据>运维业务元数据</h1><p>运维平台从元数据管理和配置管理进行了设计，元数据包括端口、IP地址、服务等。运维同学可以新建一些元数据，然后对这些元数据进行操作。这就很简单了，无非就是对一些 Document 的增删改查，由于笔者之前在某游戏公司工作，这个想法参考了某游戏公司的实现。</p><p>笔者是个喜欢创新的人，我们通过元数据实现了业务全景图，这样在可视化场景为运维人员提供业务拓扑、业务树、网络拓扑等组织管理形式，方便运维人员对整个业务系统运行状态和部署架构全局一览，清晰便捷。</p><h1 id=前后端分离>前后端分离</h1><p>笔者和其他的小伙伴使用了 Vue.js、ECharts 和 Naive UI 构建了 CMDB 的前端，通过 json-rpc 向后端发送请求。</p></div></div><footer id=footer><div class=footer-inner><div><div style=font-weight:700;margin-bottom:15px>发布地址</div><div><a href=https://halo.wecomz.com>Halo的主页自动加速体验（推荐）</a></div><div><a href=https://bluemiaomiao.gitee.io>Halo的主页中国境内镜像</a></div><div><a href=https://bluemiaomiao.github.io>Halo的主页中国境外镜像</a></div></div><div><div style=font-weight:700;margin-bottom:15px>友情链接</div><div><a href=https://debuginn.cn>DebugInn</a></div><div><a href=https://blog.csdn.net/qq_43442524>普通Gopher</a></div></div><div><div style=font-weight:700;margin-bottom:15px>开源软件</div><div><a href=https://bluemiaomiao.github.io/libsshd/>OpenSSH Configuration Library</a></div><div><a href=https://bluemiaomiao.github.io/fastdfs-spring-boot-starter/>FastDFS SpringBoot Starter</a></div><div><a href=https://bluemiaomiao.github.io/librocm-smi-gobinding/>AMD ROCm SMI for Golang</a></div><div><a href=https://bluemiaomiao.github.io/libnvml-smi-gobinding>NVIDIA NVML SMI for Golang</a></div><div><a href=https://www.wecomz.com/software/zgraphics>zGraphics(Prometheus GPU Exporter)</a></div><div><a href=https://www.wecomz.com/software/ztrader>zTrader Framework</a></div></div><div><div style=font-weight:700;margin-bottom:15px>其他</div><div><a href=https://values.wecomz.com>WecomZ 价值观</a></div></div></div><div class=icp><div style=min-height:13px;min-width:13px;background-image:url(/image/beian.png);background-repeat:no-repeat;background-size:contain;margin-right:5px></div><div><a href=https://beian.miit.gov.cn target=_blank>鲁ICP备2023019133号</a></div></div></footer></body><script src=../../js/halo.js type=text/javascript></script></html>